PART
{
    // This part will be deleted in the game if the RealFuels assembly is available.
	RequiresAssembly = !RealFuels
	
	// --- general parameters ---
	name = proceduralTankSRB
	module = Part
	author = AncientGammoner, NK, Tiberion, NathanKell, Swamp Ig

	// --- asset parameters ---
	MODEL
	{
		model = ProceduralParts/Parts/cylinderTank
		scale = 1,1,1
	}
	// The model is positioned so it looks right in the icon for the VAB
	// If you alter the default params, then change the position
	MODEL
	{
		model = ProceduralParts/Parts/SRBBell
		position = 0.0, -1.25, 0.0
		scale = 1,1,1
	}
	// If you want to make another SRB bell, you'll need to have a good look at 
	// the structure of these ones and keep it the same. You can add an extra 
	// SRB_BELL node to the ProceduralSRB module below.
	MODEL
	{
		model = ProceduralParts/Parts/HighRatio
		position = 0.0, -1.25, 0.0
		scale = 1,1,1
	}
	MODEL
	{
		model = ProceduralParts/Parts/LowRatio
		position = 0.0, -1.25, 0.0
		scale = 1,1,1
	}
	scale = 1
	rescaleFactor = 1

	// --- node definitions ---
	node_stack_top = 0.0, 0.5, 0.0, 0.0, 1.0, 0.0, 1
	node_stack_bottom = 0.0, -0.5, 0.0, 0.0, -1.0, 0.0, 1 
	node_attach = 0.5, 0.0, 0.0, 1.0, 0.0, 0.0, 1

	fx_exhaustFlame_yellow = 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, running
	fx_exhaustSparks_yellow = 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, running
	// fx_exhaustLight_yellow = 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, running
	fx_smokeTrail_medium = -5.0, 0.0, 0.0, 0.0, 1.0, 0.0, running

	sound_vent_medium = engage
	sound_rocket_hard = running
	sound_vent_soft = disengage
	sound_explosion_low = flameout

	// --- editor parameters ---
	cost = 4000
	category = Propulsion
	TechRequired = start
	entryCost = 15000
	subcategory = 0
	title = Procedural SRB
	manufacturer = Kerbchem Industries
	description = Made from viscoelastic nanopolymers (which were discovered by accident... growing in the back of the office mini-fridge) this solid rocket can be stretched to accommodate fuel loads of a range of sizes and shapes. Hardens to a rigid structure before launch!

	// attachment rules: stack, srfAttach, allowStack, allowSrfAttach, allowCollision
	attachRules = 1,1,1,1,0

	// --- standard part parameters ---
	mass = 3.737
	dragModelType = default
	maximum_drag = 0.3
	minimum_drag = 0.3
	angularDrag = 2
	crashTolerance = 7
	breakingForce = 200
	breakingTorque = 200
	maxTemp = 3600
	
	stagingIcon = SOLID_BOOSTER
	
	MODULE
	{
		name = ProceduralPart
		textureSet = SegmentedSRB
		
		diameterMin = 0.1
		
		// Lengths for the stock tanks are approximate as one needs to account for the bell.
		TECHLIMIT {
			// RT-10 - 1.25 x 2.4 m = 2.95 kL
			TechRequired = start
			diameterMin = 1.0
			diameterMax = 1.75
			lengthMin = 1.0
			lengthMax = 3.0
			volumeMin = 2.0
			volumeMax = 4.0
		}
		TECHLIMIT {
			// Allow cone shaped tanks to have reasonable initial shapes
			TechRequired = basicRocketry
			volumeMin = 1.5		
		}
		TECHLIMIT {
			// BACC - 1.25 x 7.1 m = 8.71 kL
			// Sepatron - 0.15 x 0.5 = 0.009 kl
			TechRequired = generalRocketry
			lengthMin = 0.125
			lengthMax = 10.0
			volumeMin = 0.001
			volumeMax = 10.0
		}
		// Seems fair that heavy rocketry should enable 2.5 dia
		TECHLIMIT {
			TechRequired = heavyRocketry
			diameterMax = 3.0
			volumeMax = 15.0
		}
		TECHLIMIT {
			TechRequired = heavierRocketry
			volumeMax = 40.0
		}
		TECHLIMIT {
			TechRequired = veryHeavyRocketry
			lengthMax = 15.0
			volumeMax = 50.0
		}
		
		TECHLIMIT {
			// Make everything unlimited for metaMaterials
			TechRequired = metaMaterials
			diameterMin = 0.01
			diameterMax = Infinity
			lengthMin = 0.01
			lengthMax = Infinity
			volumeMin = 0.01
			volumeMax = Infinity
		}
	}
	// Don't change the default length without also altering the default position above.
	MODULE
	{
		name = ProceduralShapeCylinder
		displayName = Cylinder
		TechRequired = start
		TechObsolete = advConstruction
		
		length = 2.5
		diameter = 1.25
	}
	MODULE 
	{
		name = ProceduralShapeCone
		displayName = Cone
		TechRequired = generalConstruction
		TechObsolete = advConstruction
		
		length = 2.5
		topDiameter = 0.625
		bottomDiameter = 1.25
	}
	MODULE 
	{
		name = ProceduralShapePill
		displayName = Fillet Cylinder
		TechRequired = advConstruction
		
		length = 2.5
		diameter = 1.25
		fillet = 0.25
	}
	MODULE 
	{
		name = ProceduralShapeBezierCone
		displayName = Smooth Cone
		TechRequired = advConstruction
		
		curveIdx = 1
		length = 2.5
		topDiameter = 0.625
		bottomDiameter = 1.25
	}
	MODULE
	{
		name = TankContentSwitcher
		useVolume = true
		
		TANK_TYPE_OPTION 
		{
			name = SolidFuel
			// The RT-10 and BACC both have similar dry density. 
			// When you work it out, the mass of the bell is negligible.
			dryDensity = 0.174
			// As per StretchySRB. This is way higher than stock
			// dryDensity = 1.5
			RESOURCE 
			{
				name = SolidFuel
				//isTweakable = false
				// Again no real consistency in stock KSP. Have gone with a bit lower than RT-10 dry/wet
				unitsPerT = 800
				// As per StretchySRB					
				//unitsPerKL = 125
			}
		}
	}
	
	MODULE
	{
		name = ModuleEngines
		thrustVectorTransformName = thrustTransform
		throttleLocked = True
		exhaustDamage = True
		ignitionThreshold = 0.1
		minThrust = 0
		maxThrust = 52
		heatProduction = 157
		useEngineResponseTime = True
		engineAccelerationSpeed = 10.0
		allowShutdown = False
		fxOffset = 0, 0, 0
		PROPELLANT
		{
			name = SolidFuel
			ratio = 1.0
			DrawGauge = True
		}
		atmosphereCurve
		{
		 key = 0 10
		 key = 1 20
		}
		
	}
	MODULE
	{
		name = ProceduralSRB
		
		srbBellName = SRBBell
		thrustVectorTransformName = thrustTransform
		bottomAttachNodeName = bottom
		
		selectedBellName = Surface
		
		// Heat Produced = heatPerThrust * thrust / total mass. 
		// RT-10 has 8.2, BACC has 10, Sepatron is 244
		// I've been pretty conservative here as there is issues with overheats and explosions for high-thrust, low mass rockets
		// plus the way heat is handled in the game is -- not really very physical.
		heatPerThrust = 7
		
		// If heat is still causing you issues, use the old equation which is much more conservative by setting this true
		useOldHeatRelation = false
		
		SRB_BELL 
		{
			name = Surface
			modelName = LowRatioBell
			atmosphereCurve
			{
				key = 0 250
				key = 1 230
			}
			gimbalRange = 0.25
			// The thrust for which the bell would remain unscaled.
			thrustScaleFactor = 256
			// Diameter of the top end of the bell where it attaches to the tank
			// This affects the maximum possible thrust for a given tank diameter
			// The value is doubled to limit the bell to half the area.
			bellChokeDiameter = 1.1
		}
		SRB_BELL 
		{
			name = Vacuum
			modelName = HighRatioBell
			atmosphereCurve
			{
				key = 0 264
				key = 1 215
			}
			gimbalRange = 0.1			
			thrustScaleFactor = 256
			bellChokeDiameter = 0.64
		}
	}
	MODULE
	{
		name = ModuleGimbal
		gimbalTransformName = SRBBell
		gimbalRange = 0.25
	}
	
}